<!DOCTYPE html>
<html>
    <head>
        <!--Required meta tags-->
        <meta charset="utf-8">
        <meta name="viewport"content="width=device-width, initial-scale=1">
        <!--BootstrapCSS-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <title>Home</title>
        <style>/*CSSCode*/</style>
    </head>
    <body>
        <!--HTMLCode-->
        <header class="p-3 text-bg-dark">
            <div class="container">
              <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="../index.html" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none p-2">
                    <i class="bi bi-cup-hot-fill"></i> SKAFE
                </a>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="first_element">
                        Cafe Namu
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_cafe_namu.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Cafe_Namu).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Blue Port
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_blue_port.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Blue_Port).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Pandorothy
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_pandorothy.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Pandorothy).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-end position-relative top-0 start-50">
                    <button type="button" class="btn btn-outline-light me-2" id="login">Login</button>
                    <button type="button" class="btn btn-warning" id="sign-up">Sign-up</button>
                </div>
                
              </div>
            </div>
        </header>
        
        <div class="container">
            <main>
              <div class="py-5 text-center">
                <i class="bi bi-cup-hot-fill"></i>
                <h2>SKAFE 회원가입</h2>
                <p class="lead">회원의 정보는 노쇼시 관련 정보 접수를 위해서 사용되고 있습니다. 이 점 유의해주시기 바랍니다.</p>
                <p class="lead-two">아이디는 학생의 학번으로 진행될 예정입니다.</p>
              </div>
          
              <div class="w-100 m-auto">
                <div>
                  <h4 class="mb-3">회원 정보</h4>
                  <!--localhost 3000 포트로 정보를 post 형태로 보낸다. -->
                  <form class="needs-validation" id="needs-validation" method="POST" onsubmit="auth(); return false">
                    <div class="row g-3">
                      <div class="col-sm-6">
                        <label for="firstName" class="form-label">성</label>
                        <input type="text" class="form-control" name="firstName" id="firstName" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                            성을 작성하지 않았습니다
                        </div>
                      </div>
          
                      <div class="col-sm-6">
                        <label for="lastName" class="form-label">이름</label>
                        <input type="text" class="form-control" name="lastName" id="lastName" placeholder="" value="" required="">
                        <div class="invalid-feedback">
                          이름을 작성하지 않았습니다
                        </div>
                      </div>
                      
                      <div class="col-12">
                        <label for="text" class="form-label">대상</span></label>
                        <input type="text" class="form-control" name="classification" id="classification"  value="" required="" readonly>
                        <div class="invalid-feedback">
                            오류, 뒤로가기를 눌러주세요
                        </div>
                      </div>

                      <div class="col-12">
                        <label for="number" class="form-label">학번<span class="text-muted">(10자리)</span></label>
                        <input type="text" class="form-control" name="student_number" id="student_number" placeholder="2020300000" required="" pattern="[0-9]{10}">
                        <div class="invalid-feedback">
                            학번을 적지 않았습니다
                        </div>
                      </div>
          
                      <div class="col-12">
                        <label for="text" class="form-label">비밀번호</label>
                        <input type="text" class="form-control" name="passw" id="passw" placeholder="8자리 이상 16자리 이하 숫자, 특수문자 필수" required="" pattern="^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,16}$">
                        <div class="invalid-feedback">
                          비밀번호를 작성해주시오
                        </div>
                      </div>
          
                    <hr class="my-4">
          
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="same-address" required="">
                      <label class="form-check-label" for="same-address">SKAFE가 학번을 활용하는 것에 대해 동의합니다</label>
                      <div class="invalid-feedback">
                        체크해주세요
                      </div>
                    </div>
          
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="save-info" required="">
                      <label class="form-check-label" for="save-info">회원의 정보 유출에 대해서는 회사가 책임을 지지 않습니다</label>
                      <div class="invalid-feedback">
                        체크해주세요
                      </div>
                    </div>
          
                    <hr class="my-4">
          
                    <button class="w-100 btn btn-primary btn-lg" type="submit" id="admin_user">회원 가입</button>

                  </form>
                </div>
              </div>
            </main>
            <iframe id="real" name="real" style="display:none"></iframe>
          </div>


        
        <div class="container">
            <footer class="py-3 my-4">
              <ul class="nav justify-content-center border-bottom pb-3 mb-3">
                <li class="nav-item"><a href="/" class="nav-link px-2 text-muted">Home</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
              </ul> 
              <p class="text-center text-muted">© 2022 Company, Inc</p>
            </footer>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"crossorigin="anonymous">
        </script>

        
        <script>/*JSCode*/
            /*log - in btn이 클릭되면 login html로 이동한다*/
            let sign_type=location.href.split('?')[1];
            console.log(sign_type)
            let login_button=document.querySelector("#login");
            login_button.addEventListener("click",()=>{
                location.href="./login.html"
            });

            /*sign up btn이 클릭되면 sign-up html로 이동한다*/
            let signup_btn=document.querySelector("#sign-up");
            signup_btn.addEventListener("click",()=>{
                location.href="./sign-up.html"
            });
            
            //sign-up.html에서 선택한 유저 정보를 바탕으로 class_id 정보 생성
            let classquery = window.location.search;
            let classparam = new URLSearchParams(classquery);
            if(classparam.get('id')==="stu")
            {
                class_id="education";
            }
            else if(classparam.get('id')==="cafe")
            {
                class_id="cafemanager";
            }
            else
            {
                class_id="engineer";
            }
            //form의 분류(대상)정보에 넣어준다.
            $('input[name=classification]').attr('value',class_id);

            //Post형식으로 temp_server에 form 정보를 보냄
           function auth() {
                //namu 9000000000~9099999999 blueport 9100000000~9199999999 pandorothy 9200000000~9299999999
                let input_st=document.getElementById('student_number');
                if(class_id==="cafemanager"){
                    if(9000000000<=parseInt(input_st.value) && 9299999999>=parseInt(input_st.value))
                    {
                        let sublog = $('#needs-validation').serialize();
                        console.log("authclicked");
                        $.ajax({
                            type: "POST",
                            url: "http://localhost:3000/signup",
                            data: sublog,
                            //성공시 200, 실패시 400
                            success: function (data) {
                                alert("WELCOME");
                                window.location.href="../index.html"
                            },
                            error: function (request, status, error) {
                                alert("이미 등록된 학번입니다");
                            }
                        });
                    }
                    else{
                        alert("가게에게 할당받은 학번이 아닙니다");
                    }
                }
                else
                {
                    let sublog = $('#needs-validation').serialize();
                    console.log("authclicked");
                    $.ajax({
                        type: "POST",
                        url: "http://localhost:3000/signup",
                        data: sublog,
                        //성공시 200, 실패시 400
                        success: function (data) {
                            alert("WELCOME");
                            window.location.href="../index.html"
                        },
                        error: function (request, status, error) {
                            alert("이미 등록된 학번입니다");
                        }
                    });
                }
                
            };
            
            

            //form submit할 때 새로고침 되지 않도록 설정
            (() => {
            const forms = document.querySelectorAll('.needs-validation')
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        //const nameInput = event.target['student_number'];
                        //console.log(`제출된 닉네임은 ${nameInput.value}입니다.`);
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
            })()


            

        </script>
    </body>
</html>


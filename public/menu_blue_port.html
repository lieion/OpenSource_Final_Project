<!DOCTYPE html>
<html>
    <head>
        <!--Required meta tags-->
        <meta charset="utf-8">
        <meta name="viewport"content="width=device-width, initial-scale=1">
        <!--BootstrapCSS-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
        <link rel="stylesheet" href="./css/menupage.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <link href="https://fonts.googleapis.com/earlyaccess/notosanskr.css" rel="stylesheet">

        <title>Home</title>
        <style>
            .navbar-toggler{
                margin-right: 30px;
            }
            .bi-cup-hot-fill{
                padding-right: 8px;
            }
            .dropdown-item{
                margin-top: 5px;
            }
            .dropdown-toggle{
                margin-left: 20px;
            }
        </style>
    </head>
    <body>
        <header class="p-3 text-bg-dark">
            <div class="container">
              <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="../index.html" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none p-2">
                    <i class="bi bi-cup-hot-fill"></i> SKAFE
                </a>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="first_element">
                        Cafe Namu
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_cafe_namu.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Cafe_Namu).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Blue Port
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_blue_port.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Blue_Port).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-center p-2" id="navbar_item">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Pandorothy
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="./menu_pandorothy.html">메뉴</a></li>
                        <li><a class="dropdown-item" href="./location(Pandorothy).html">지도</a></li>
                        <li><a class="dropdown-item" href="#">행사</a></li>
                      </ul>
                </div>

                <div class="text-end position-relative top-0 start-50">
                    <button type="button" class="btn btn-outline-light me-2" id="login">Login</button>
                    <button type="button" class="btn btn-warning" id="sign-up">Sign-up</button>
                </div>
                
              </div>
            </div>
        </header>
        <h1 class="menubar">
            Menu - Blue Port
        </h1>
        <div class="product-list container col-xl-10 col-xxl-8 px-4 py-5">
            <a class="d-flex product">
                <img src="./img/ice_americano.jfif" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [ICE] Americano
                    </h3>
                    <h4 class="product-price">
                        2,000 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn1_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn1_input" readonly>
                    <button type="button" class="plus" id="btn1_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>

            <a class="d-flex product">
                <img src="./img/ice_latte.jpg" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [ICE] Latte
                    </h3>
                    <h4 class="product-price">
                        3,500 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn2_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn2_input" readonly>
                    <button type="button" class="plus" id="btn2_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>

            <a class="d-flex product">
                <img src="./img/hot_latte.jpg" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [HOT] Latte
                    </h3>
                    <h4 class="product-price">
                        3,000 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn3_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn3_input" readonly>
                    <button type="button" class="plus" id="btn3_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>

            <a class="d-flex product">
                <img src="./img/ice_choco.jpg" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [ICE] Ice Choco
                    </h3>
                    <h4 class="product-price">
                        3,000 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn4_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn4_input" readonly>
                    <button type="button" class="plus" id="btn4_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>

            <a class="d-flex product">
                <img src="./img/mango_smoothie.jpg" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [ICE] Mango Smoothie
                    </h3>
                    <h4 class="product-price">
                        4,000 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn5_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn5_input" readonly>
                    <button type="button" class="plus" id="btn5_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>

            <a class="d-flex product">
                <img src="./img/ice_greentea_latte.jpg" width="180" height="180" class="images">
                <div class="product-info"> 
                    <h3 class="product-name">
                        [ICE] Greentea Latte
                    </h3>
                    <h4 class="product-price">
                        3,500 won
                    </h4>
                </div>
                <div class="d-flex cnt-wrap">
                    <button type="button" class="minus" id="btn6_min"><i class="bi bi-dash"></i></button>
                    <input type="text" class="input" value="0" id="btn6_input" readonly>
                    <button type="button" class="plus" id="btn6_plus"><i class="bi bi-plus"></i></button>
                </div>
            </a>
        </div>
        <div class="d-flex total_price">
            <h4 class="price">Total: </h4>
            <h4 class="total" id="totalcost">0</h4>
            <h4 class="won">won</h4>
        </div>
        <div class="order">
            <button type="button" class="btn btn-lg btn-success" style="float: right;" id="orderBtn">Order</button>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"crossorigin="anonymous">
        </script>
        <script>/*JSCode*/
            //세션에 암호화하고 하는 로그인 설정 대신 로컬스토리지로 로그인 상태 대체
            let tsk=localStorage.getItem('id');
            console.log(tsk)
            let login_state=0
            let loginBtnPart=document.getElementById('login');
            let signUpPart=document.getElementById('sign-up');
            let login_button=document.querySelector("#login");
            let signup_btn=document.querySelector("#sign-up");
            let order_btn=document.getElementById('orderBtn');

            let btn1_min=document.getElementById('btn1_min');
            let btn1_input=document.getElementById('btn1_input');
            let btn1_plus=document.getElementById('btn1_plus');
            let btn2_min=document.getElementById('btn2_min');
            let btn2_input=document.getElementById('btn2_input');
            let btn2_plus=document.getElementById('btn2_plus');
            let btn3_min=document.getElementById('btn3_min');
            let btn3_input=document.getElementById('btn3_input');
            let btn3_plus=document.getElementById('btn3_plus');
            let btn4_min=document.getElementById('btn4_min');
            let btn4_input=document.getElementById('btn4_input');
            let btn4_plus=document.getElementById('btn4_plus');
            let btn5_min=document.getElementById('btn5_min');
            let btn5_input=document.getElementById('btn5_input');
            let btn5_plus=document.getElementById('btn5_plus');
            let btn6_min=document.getElementById('btn6_min');
            let btn6_input=document.getElementById('btn6_input');
            let btn6_plus=document.getElementById('btn6_plus');
            let totalcost=document.getElementById('totalcost');
            let cal_cost=0


            function fetching_cost(){
                $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/getCost",
                    data: {
                        market: 2,
                        price: [btn1_input.value,btn2_input.value,btn3_input.value,btn4_input.value,btn5_input.value,btn6_input.value]
                    },
                    success: function (data) {
                        console.log(data);
                        cal_cost=data;
                        totalcost.innerText=cal_cost.toString();

                    },
                    error: function (request, status, error) {
                        console.log("ERROR");
                    }
                });
            }
     
            /*log - in btn이 클릭되면 login html로 이동한다*/
            if (tsk===undefined || tsk==="0" || tsk===null)
            {
                login_state=0;
                loginBtnPart.innerText = 'Login';            
                signUpPart.disabled=false;
                /*log - in btn이 클릭되면 login html로 이동한다*/              
                login_button.addEventListener("click",()=>{
                    location.href="./login.html"
                });
                /*sign up btn이 클릭되면 sign-up html로 이동한다*/            
                signup_btn.addEventListener("click",()=>{
                    location.href="./sign-up.html"
                });
                order_btn.addEventListener("click",()=>{
                    alert("로그인을 하셔야 주문할 수 있습니다");
                });
            }
            else
            {
                login_state=1;
                loginBtnPart.innerText = 'Log-Out';
                signUpPart.innerText = 'My Page';
                /*log - in btn이 클릭되면 login html로 이동한다*/
                login_button.addEventListener("click",()=>{
                    localStorage.setItem('id','0');
                    location.href="../index.html"
                });
                /*sign up btn이 클릭되면 sign-up html로 이동한다*/
                signup_btn.addEventListener("click",()=>{
                    location.href="./myPage.html"
                });
                order_btn.addEventListener("click",()=>{
                    alert("주문");
                    $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/order",
                    data: {
                        student_number: tsk,
                        market: 2,
                        total: cal_cost,
                        price: [btn1_input.value,btn2_input.value,btn3_input.value,btn4_input.value,btn5_input.value,btn6_input.value]
                    },
                    success: function (data) {
                        alert("주문 완료");
                        console.log(data);
                        window.location.href="./myPage.html"
                    },
                    error: function (request, status, error) {
                        if (request.status===400) alert("주문이 비어있습니다")
                        else alert("주문 실패");
                    }
                    });
                });
            }

            btn1_min.addEventListener("click",()=>{
                let input_number=btn1_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn1_input.value=input_number
                fetching_cost();
            });
            btn2_min.addEventListener("click",()=>{
                let input_number=btn2_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn2_input.value=input_number
                fetching_cost()
            });
            btn3_min.addEventListener("click",()=>{
                let input_number=btn3_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn3_input.value=input_number
                fetching_cost()
            });
            btn4_min.addEventListener("click",()=>{
                let input_number=btn4_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn4_input.value=input_number
                fetching_cost()
            });
            btn5_min.addEventListener("click",()=>{
                let input_number=btn5_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn5_input.value=input_number
                fetching_cost()
            });
            btn6_min.addEventListener("click",()=>{
                let input_number=btn6_input.value;
                input_number=parseInt(input_number)-1;
                if(input_number>-1) btn6_input.value=input_number
                fetching_cost()
            });
            btn1_plus.addEventListener("click",()=>{
                let input_number=btn1_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn1_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });
            btn2_plus.addEventListener("click",()=>{
                let input_number=btn2_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn2_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });
            btn3_plus.addEventListener("click",()=>{
                let input_number=btn3_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn3_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });
            btn4_plus.addEventListener("click",()=>{
                let input_number=btn4_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn4_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });
            btn5_plus.addEventListener("click",()=>{
                let input_number=btn5_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn5_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });
            btn6_plus.addEventListener("click",()=>{
                let input_number=btn6_input.value;
                input_number=parseInt(input_number)+1;
                if (input_number<11){
                    btn6_input.value=input_number
                }
                else{
                    alert("같은 메뉴는 최대 10개까지 주문할 수 있습니다");
                }
                fetching_cost()
            });

            
            
        </script>
    </body>
</html>
